## mako

<%page expression_filter="h"/>
<%!
from django.utils.translation import ugettext as _

from lms.djangoapps.courseware.date_summary import CourseAssignmentDate
from course_modes.models import CourseMode
%>

% if on_dates_tab and not missed_deadlines and getattr(course, 'self_paced', False):
    <div class="dates-banner">
        <div class="dates-banner-text">
            <strong>${_("We've built a suggested schedule to help you stay on track.")}</strong>
            ${_("But don't worry—it's flexible so you can learn at your own pace. If you happen to fall behind on our suggested dates, you'll be able to adjust them to keep yourself on track.")}
        </div>
    </div>
% endif
<%
has_locked_assignments = any(hasattr(block, 'contains_gated_content') and block.contains_gated_content for block in course_date_blocks if isinstance(block, CourseAssignmentDate)) if (course_date_blocks and on_dates_tab) else False
is_verified = enrollment_mode == CourseMode.VERIFIED
is_audit = enrollment_mode == CourseMode.AUDIT
on_dates_tab_as_audit = on_dates_tab and is_audit
on_dates_tab_as_verified = on_dates_tab and is_verified
on_course_outline_page_as_audit = on_course_outline_page and is_audit
on_course_outline_page_as_verified = on_course_outline_page and is_verified
on_courseware_page_as_audit = on_courseware_page and is_audit
on_courseware_page_as_verified = on_courseware_page and is_verified
additional_styling_class = 'on-mobile' if is_mobile_app else 'has-button'
%>
% if (missed_deadlines and (on_dates_tab_as_verified or on_courseware_page)):
    <div class="dates-banner ${additional_styling_class}">
        <div class="dates-banner-text">
            % if is_mobile_app:
                % if is_verified:
                    ${_('It looks like you missed some important deadlines based on our suggested schedule. ')}
                    ${_('To keep yourself on track, you can update this schedule and shift the past due assignments into the future by visiting ')}
                    <a class="mobile-dates-link" href="${web_app_course_url}">edx.org</a>.
                    ${_(' Don’t worry—you won’t lose any of the progress you’ve made when you shift your due dates.')}
                % else:
                    <strong>${_('You are auditing this course,')}</strong>
                    ${_(' which means that you are unable to participate in graded assignments.')}
                    ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today by visiting ')}
                    <a class="mobile-dates-link" href="${verified_upgrade_link}">edx.org</a>.
                % endif
            % else:
                % if is_verified:
                    <strong>${_('It looks like you missed some important deadlines based on our suggested schedule.')}</strong>
                    ${_('To keep yourself on track, you can update this schedule and shift the past due assignments into the future. Don’t worry—you won’t lose any of the progress you’ve made when you shift your due dates.')}
                % endif
                % if is_audit:
                    <strong>${_('You are auditing this course,')}</strong>
                    ${_(' which means that you are unable to participate in graded assignments.')}
                    ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today.')}
                % endif
            % endif
        </div>
        % if not is_mobile_app:
            <div class="upgrade-button">
                % if is_verified:
                    <form method="post" action="${reset_deadlines_url}">
                        <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                        <input type="hidden" name="reset_deadlines_redirect_url_base" value="${reset_deadlines_redirect_url_base}">
                        <input type="hidden" name="reset_deadlines_redirect_url_id_dict" value="${reset_deadlines_redirect_url_id_dict}">
                        <button class="btn reset-deadlines-button">${_("Reset my deadlines")}</button>
                    </form>
                % endif
                % if is_audit:
                    <a href="${verified_upgrade_link}">
                        <button type="button">
                            ${_('Upgrade to shift due dates')}
                        </button>
                    </a>
                % endif
            </div>
        % endif
    </div>
% elif on_dates_tab_as_audit and has_locked_assignments:
<div class="dates-banner ${additional_styling_class}">
    <div class="dates-banner-text">
        % if is_mobile_app:
            <strong>${_('You are auditing this course,')}</strong>
            ${_(' which means that you are unable to participate in graded assignments.')}
            ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today by visiting ')}
            <a class="mobile-dates-link" href="${verified_upgrade_link}">edx.org</a>.
        % else:
            <strong>${_('You are auditing this course,')}</strong>
            ${_(' which means that you are unable to participate in graded assignments.')}
            % if missed_deadlines:
                ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today.')}
            % else:
                ${_(' To complete graded assignments as part of this course, you can upgrade today.')}
            % endif
        % endif
    </div>
    % if not is_mobile_app:
        <div class="upgrade-button">
            <a href="${verified_upgrade_link}">
                <button type="button">
                    % if missed_deadlines:
                        ${_('Upgrade to shift due dates')}
                    % else:
                        ${_('Upgrade now')}
                    % endif
                </button>
            </a>
        </div>
    % endif
</div>
% elif on_course_outline_page and (is_audit or is_verified):
<div class="dates-banner ${additional_styling_class}">
    <div class="dates-banner-text">
        % if is_mobile_app:
            % if is_verified:
                ${_('It looks like you missed some important deadlines based on our suggested schedule. ')}
                ${_('To keep yourself on track, you can update this schedule and shift the past due assignments into the future by visiting ')}
                <a class="mobile-dates-link" href="${web_app_course_url}">edx.org</a>.
                ${_(' Don’t worry—you won’t lose any of the progress you’ve made when you shift your due dates.')}
            % else:
                <strong>${_('You are auditing this course,')}</strong>
                ${_(' which means that you are unable to participate in graded assignments.')}
                ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today by visiting ')}
                <a class="mobile-dates-link" href="${verified_upgrade_link}">edx.org</a>.
            % endif
        % else:
            % if is_verified:
                <strong>${_('It looks like you missed some important deadlines based on our suggested schedule.')}</strong>
                ${_('To keep yourself on track, you can update this schedule and shift the past due assignments into the future. Don’t worry—you won’t lose any of the progress you’ve made when you shift your due dates.')}
            % endif
            % if is_audit:
                <strong>${_('You are auditing this course,')}</strong>
                ${_(' which means that you are unable to participate in graded assignments.')}
                     ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today.')}
                % endif
            % endif
        % endif
    </div>
    % if not is_mobile_app:
        <div class="upgrade-button">
            % if is_verified:
                <form method="post" action="${reset_deadlines_url}">
                    <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                    <input type="hidden" name="reset_deadlines_redirect_url_base" value="${reset_deadlines_redirect_url_base}">
                    <input type="hidden" name="reset_deadlines_redirect_url_id_dict" value="${reset_deadlines_redirect_url_id_dict}">
                    <button class="btn reset-deadlines-button">${_("Reset my deadlines")}</button>
                </form>
            % endif
            % if is_audit:
                <a href="${verified_upgrade_link}">
                    <button type="button">
                            ${_('Upgrade to shift due dates')}
                        % endif
                    </button>
                </a>
            % endif
        </div>
    % endif
</div>
% endif

